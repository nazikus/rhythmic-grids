function drawTesseract(){function e(e,t){var n=a.camera.transform;n.reset(),n.rotateZ(0),n.rotateY(-2.06*e-.5),n.rotateX(2.2*t+1.5),n.translate(0,0,-12)}function t(){a.clearBackground(),a.bufferShape(i),a.drawBuffer(),a.emptyBuffer()}var n=document.getElementById("tesseract"),a=new Pre3d.Renderer(n),i=Pre3d.ShapeUtils.makeTesseract(2);a.draw_overdraw=!1,a.fill_rgba=new Pre3d.RGBA(1,1,1,0),a.ctx.lineWidth=2,a.stroke_rgba=new Pre3d.RGBA(221/255,221/255,221/255,.33),a.camera.focal_length=6,e(0,0),document.addEventListener("mousemove",function(n){e(n.clientX/1600,n.clientY/1600),t()},!1);var r=0,l=2*Math.PI/1600;intervalId=setInterval(function(){r+=l,i=Pre3d.ShapeUtils.rotateTesseract(i,r),t()},40),t()}function gridSound(){function e(){n(4),a.type="sine",a.connect(i.destination),a.start(0)}function t(){a.stop(0),a.disconnect(i.destination)}function n(e){a.frequency.value=5e3}var a,i,r;return r=window.AudioContext||window.webkitAudioContext,i=new r,a=i.createOscillator(),{setFrequency:n,makeSound:e,stopSound:t}}function getAvailableSystemFonts(){detective=new FontDetector;var e=getFontList(),t=[];return e.forEach(function(e){detective.detect(e)&&t.push(e)}),t}function onFontChange(e){var t=$(this).attr("id"),n=$("#input-lineheight"),a=$("#input-fontsize");switch(localStorage.setItem(t,this.value),t){case"select-font":$(".example-text").css("font-family",this.value+",monospace"),$(".text").css("font-family",this.value+",monospace"),metricsContext.curr_typeface=this.value,drawMetrics(),drawText();break;case"input-fontsize":n.val(Math.round(_LHFS_R*_int(this.value))+"px"),$(".example-text").css("font-size",_int(this.value)+"px"),$(".example-text").css("line-height",_int(n.val())+"px"),$(".text").css("font-size",parseInt(this.value)+"px");break;case"input-lineheight":_LHFS_R=_int(this.value)/_int(a.val()),$(".example-text").css("line-height",_int(this.value)+"px")}var i=_int(n.val()),r=$("#baseline-info-text"),l=$("#baseline-invalid-text");if(i%2==0||i%3==0){if(_LHBL_F=i%2?3:2,n.css("background-color",""),r.text(i/_LHBL_F+" px"),l.text(""),r.removeClass("invalid-baseline"),allConfigs){el=allConfigs.radioForms[2],$("input",el).each(function(){$(this).prop("disabled",!1)});var o=localStorage.getItem($(el).attr("id")),s=o?'input[value="'+o+'"]':"input:first";$(s,el).prop("checked",!0),$("#gridBaseline > input[value="+i/_LHBL_F+"]").prop("checked",!0),$(".rulers-wrapper-horizontal").removeClass("hidden"),allConfigs.radioForms.eq(0).trigger("change")}resetBaselineSelections()}else _LHBL_F=i/i,n.css("background-color","lightpink"),r.text("not valid"),l.text("Line height must be divisible by 2 or 3."),r.addClass("invalid-baseline"),allConfigs&&(el=allConfigs.radioForms[2],$("input:checked",$(el)).val()&&localStorage.setItem($(el).attr("id"),$("input:checked",$(el)).val()),$("input",el).each(function(){$(this).prop("disabled",!0).val([])}),$(".text").css("line-height",i+"px"),$(".rulers-wrapper-horizontal").addClass("hidden"));$("#lineheight-percent-label").text(Math.round(_int(n.val())/_int(a.val())*100)+"%")}function resetBaselineSelections(){for(var e=$("#gridBaseline"),t=_int($("#input-fontsize").val()),n=_int($("#input-lineheight").val()),a=Math.round(t*allConfigs.lineHeightLimit.min),i=Math.round(t*allConfigs.lineHeightLimit.max),r=[],l="gridBaseline",o=a;i>=o;o++)o%_LHBL_F==0&&r.push(o/_LHBL_F);e.empty(),r.forEach(function(t,a){var i=$("<input>").prop({type:"radio",id:l+String(t),name:l,value:t});t*_LHBL_F==n&&i.prop("checked",!0);var r=$("<label>").prop("for",l+t).text(t);e.append(i).append(r)})}function onKeyDown(e){var t=$(e.target),n=_int(t.val()),a=e.which||e.keyCode,i=null;if("input-fontsize"===t.attr("id")&&(i=allConfigs.fontSizeLimit),"input-lineheight"===t.attr("id")){var r=_int($("#input-fontsize").val());i={min:Math.round(r*allConfigs.lineHeightLimit.min),max:Math.round(r*allConfigs.lineHeightLimit.max)}}[38,40,13].indexOf(a)>-1&&(40===a&&(n=n>i.min?n-1:n),38===a&&(n=n<i.max?n+1:n),13===a&&(n=n<i.min?i.min:n>i.max?i.max:n),t.val((isNaN(n)?i.min:n)+"px"),e.preventDefault(),t.trigger("change"))}function onMetricsTextChange(e){var t=metricsContext,n=e.keyCode||e.which;[37,38,39,40,16,17,18].indexOf(n)>-1||(t.curr_mtext=this.value,t.curr_mtext_width=t.curr_mtext?Math.round(t.contextT.measureText(t.curr_mtext).width):0,drawText())}function getFontList(){return["Georgia","Baskerville","Baskerville Old Face","Century","Lucida Bright","Times","Helvetica","Helvetica Neue","Arial","Verdana","Century Gothic","Calibri","Charter","Avenir","PT Serif","PT Sans"]}function setupRadioItems(){allConfigs.radioForms.each(function(e,t){$(t).empty(),$(t).append(createRadioInputs(allConfigs.inputNames[e],allConfigs.rangeArrs[e]));var n=localStorage.getItem($(t).attr("id"));if(n&&$('input[value="'+n+'"]',t).prop("checked",!0),"gridRatio"===$(t).attr("id")){var a=$("#gridRatio > input:checked").val();$(".ratio-selector input[name=ratioSelector][id=ratio"+a+"]").prop("checked",!0)}$(t).on("change",onGridChange)}),$("#input-fontsize").trigger("change")}function createRadioInputs(e,t){var n=[];return t.forEach(function(t,a){var i=$("<input>").prop({type:"radio",id:e+String(t),name:e,value:t}),r=allConfigs.inputNames;switch(e){case r[0]:1==a&&i.prop("checked",!0);break;case r[1]:0==a&&i.prop("checked",!0);break;case r[2]:1==a&&i.prop("checked",!0);break;case r[3]:2==a&&i.prop("checked",!0);break;case r[4]:3==a&&i.prop("checked",!0)}switch(allConfigs.inputNames.indexOf(e)){case 1:labelText=t.replace("x",":");break;case 4:labelText=allConfigs.baselineArr[0]*t;break;default:labelText=String(t)}var l=$("<label>").prop("for",e+String(t)).text(labelText);n.push(i,l)}),n}function onGridChange(e){var t=function(){return $("input:checked",allConfigs.radioForms).map(function(){var e=$(this).val();return isNaN(e)?e:~~e}).toArray()},n=$(e.target).parent(),a=t();refreshRadioInputs(allConfigs.radioForms,a),a=t();var i=$("input:checked",n);if("gridRatio"===n.attr("id")){var r=i.val();$(".ratio-selector input[name=ratioSelector][id=ratio"+r+"]").prop("checked",!0)}if("gridBaseline"===n.attr("id")){var l=i.val()*_LHBL_F;$("#input-lineheight").val(l+"px"),$(".example-text").css("line-height",l+"px"),$("#baseline-info-text").text(i.val()+" px"),_LHFS_R=l/parseInt($("#input-fontsize").val()),$("#lineheight-percent-label").text(Math.round(l/parseInt($("#input-fontsize").val())*100)+"%")}localStorage.setItem(n.attr("id"),i.val());var o=RhythmicGridGenerator.selectGrid(allConfigs.allValidGrids,a);o?($("#photoshopButton").removeClass("link-disabled").attr("href","http://162.247.154.128/psd?w="+o.maxCanvasWidth+"&r="+o.ratio.str+"&b="+o.baseline+"&c="+o.columnsNum+"&g="+o.gutter.W/o.baseline),drawRhythmicGrid(o)):($("#photoshopButton").addClass("link-disabled"),allConfigs.gridContainer.empty())}function refreshRadioInputs(e,t){var n=RhythmicGridGenerator.getValidConfigValues(allConfigs.allValidGrids,t),a=allConfigs.inputNames;if(a.length!==n.length)throw"ERROR: wrong length of IDs in "+arguments.callee.name+"()";n.forEach(function(n,i){$("input",e[i]).each(function(e,r){$(this).prop("disabled",!n[e][1]||null),a[i]===a[a.length-1]&&$(this).next().text(n[e][0]*t[2])});var r=$("input:checked",e[i]);if(r.prop("disabled")){var l=$("input:enabled:last",e[i]);l.length&&l.prop("checked",!0)}})}function drawRhythmicGrid(e){var t=performance.now();$("#grid-width-text").text(e.rhythmicGrid.W+" px"),$("#column-width-text").text(e.rhythmicGrid.blocks[0][0]+" px");var n=allConfigs.gridContainer,a=0;n.empty(),e.rhythmicGrid.blocks.forEach(function(t,i,r){var l=$("<div>").addClass("row"),o=(t[0],t[1]),s=t[2];if(0==e.gutter.W){for(var c=1;s>=c;c++){var d=$("<div>").addClass("inner").addClass("inner"+c),p=a++%allConfigs.imageMocks+1;d.attr("style","background-image: url(img/"+e.ratio.str+"/"+p+".jpg)");var u=$("<div>").addClass("column").append(d);l.append(u)}return void n.append(l)}if(!(s>9)){for(var c=1;s>=c;c++)if(i!==r.length-1){var d=$("<div>").addClass("inner").addClass("inner"+c);if(a++,1!==c||a%2||a++,a%2||i+1===r.length){var p=Math.floor(a/2)%allConfigs.imageMocks+1;d.attr("style","background-image: url(img/"+e.ratio.str+"/"+p+".jpg)")}else{var h=allConfigs.textMocks[i]+".";d.height(o),d.append($("<span>").addClass("strut").height(parseInt($("#input-lineheight").val()))),d.append($("<span>").addClass("text").text(h).height(o))}var u=$("<div>").addClass("column").append(d);l.append(u)}n.append(l)}});var i=e.gutter.W,r=e.rhythmicGrid.margin;$("body").css({"min-width":e.maxCanvasWidth+"px"}),$(".grid-outer-wrapper").css({"max-width":e.maxCanvasWidth+"px",padding:(r>30?30:r)+"px 0"}),$(".grid-container").css({"max-width":e.rhythmicGrid.W+"px","margin-bottom":0}),$(".row").css({"margin-left":-(i/2),"margin-right":-(i/2)}),$(".column").css({"padding-left":i/2,"padding-right":i/2,"padding-bottom":i}),$(".column .inner").css("padding-bottom",100/e.ratio.R+"%");var l=parseInt($("#input-fontsize").val()),o=parseInt($("#input-lineheight").val());$(".column .inner .text").css({"font-family":$("#select-font").val()+", monospace","font-size":l+"px","line-height":o+"px"});var s=performance.now();$(".grid-section .inner").has(".text").each(function(){for(var t=".",n=$(".text",this),a=n.text().split(" "),i="",r=this,l=0;l<a.length;l++)if(i=a.slice(0,l).join(" "),n.text(i+" "+a[l]+t),r.scrollHeight>r.clientHeight+e.baseline){n.text(i+t);break}});for(var c=(performance.now()-s,$("<div>").addClass("rulers-wrapper-vertical")),d=$("<div>").addClass("rulers-wrapper-horizontal"),p=allConfigs.gridContainer.height(),u=0;u<Math.ceil(p/e.baseline)+1;u++)d.append('<div class="ruler-horizontal"></div>');for(var u=0;u<e.columnsNum;u++)c.append('<div class="ruler-vertical-outer"><div class="ruler-vertical"></div></div>');n.append(c),n.append(d),$(".rulers-wrapper-vertical").css({"margin-left":-(i/2),"margin-right":-(i/2)}),$(".ruler-vertical-outer").css({"padding-left":i/2,"padding-right":i/2}),$(".ruler-horizontal").css({"margin-bottom":e.baseline-1}),"on"===$("#grid-toggle").data("grid-toggle")?($(".rulers-wrapper-vertical").removeClass("hidden"),$(".rulers-wrapper-horizontal").removeClass("hidden")):($(".rulers-wrapper-vertical").addClass("hidden"),$(".rulers-wrapper-horizontal").addClass("hidden"));performance.now()-t}function drawText(){var e=performance.now(),t=metricsContext,n=t.canvasT,a=t.contextT;if(a.clearRect(0,0,n.width,n.height),a.font=t.metrics_fallback,a.font=t.metrics_fontsize+"px "+t.curr_typeface,n.style.font=a.font,a.font!=t.metrics_fallback){a.fillText(t.curr_mtext,t.translated,t.baseline_y);performance.now()-e}}function drawMetrics(){var e=performance.now(),t=!1,n=metricsContext.canvas,a=metricsContext.context,i=metricsContext.metrics_fontsize,r=metricsContext.baseline_y,l=metricsContext.xOffL;a.clearRect(0,0,n.width,n.height),a.font=metricsContext.metrics_fallback,a.font=i+"px "+metricsContext.curr_typeface,n.style.font=a.font,a.font==metricsContext.metrics_fallback&&(t=!0),metricsContext.curr_mtext_width=Math.round(a.measureText(metricsContext.curr_mtext).width);var o=a.measureText(metricsContext.reference_alphabet),s=o.ascent,c=o.descent,d=a.measureText("x").ascent,p=a.measureText("H").ascent,u=Math.round(i/2),h=Math.round(500*(d/u-1)),g=(h>=0?"+ ":"â€“ ")+Math.abs(h)+" UPM",f=Math.abs(h)<=50;line_length=n.width-metricsContext.xOffR,labelRectW=116,labelRectH=30,$("#x-height-offset-text").text(g).removeClass("invalid-offset"),f||$("#x-height-offset-text").addClass("invalid-offset"),a.font=metricsContext.label_font,n.style.font=a.font,a.beginPath(),a.fillStyle="rgba(230, 230, 230, 0.5)",a.lineWidth=0,a.clearRect(0,r-u,line_length,u);var m=document.getElementById("fontmetrics-pattern"),v=a.createPattern(m,"repeat");if(a.rect(0,r-u,line_length,u),a.fillStyle=v,a.fill(),a.beginPath(),a.strokeStyle="rgba(230, 230, 230, 0.5)",a.lineWidth=1,a.moveTo(0,r-u-1),a.lineTo(line_length,r-u-1),a.stroke(),a.beginPath(),a.strokeStyle="#C5C5C5",a.fillStyle="white",a.lineWidth=2,a.setLineDash([5,2]),a.moveTo(0,r-s),a.lineTo(line_length,r-s),a.stroke(),a.beginPath(),a.moveTo(0,r+c),a.lineTo(line_length,r+c),a.stroke(),a.beginPath(),a.setLineDash([0,0]),a.fillStyle="#C5C5C5",a.lineWidth=2,a.fillRect(0,r-s-1,labelRectW,labelRectH),a.beginPath(),a.fillStyle="#C5C5C5",a.lineWidth=2,a.fillRect(0,r+c-labelRectH+1,labelRectW,labelRectH),a.beginPath(),a.setLineDash([]),a.fillStyle="#D0021B",a.lineWidth=0,a.fillRect(n.width-labelRectW,r-p-labelRectH,labelRectW,labelRectH),a.beginPath(),a.fillStyle="#D0021B",a.lineWidth=0,a.fillRect(n.width-labelRectW,r,labelRectW,labelRectH),a.beginPath(),a.strokeStyle="#D0021B",a.fillStyle="white",a.lineWidth=2,a.moveTo(l,r+Math.floor(a.lineWidth/2)),a.lineTo(line_length,r+Math.floor(a.lineWidth/2)),a.stroke(),a.textBaseline="top",a.textAlign="right",a.fillText("baseline",line_length-10,r),t)return void $(".example-text").css("color","white");$(".example-text").css("color",""),a.beginPath(),a.strokeStyle="#fff",a.fillStyle="#D0021B",a.lineWidth=0,a.moveTo(l,r-d),a.lineTo(line_length,r-d),a.stroke(),a.beginPath(),a.fillStyle=hex2rgba(f?"#8014CF74":"#80FFA500"),a.fillRect(l,r-d,line_length,d-u),a.textBaseline=h>0?"bottom":"top",a.textAlign="right",a.font=metricsContext.label_font_upm,a.fillStyle="black",a.fillText(g,line_length,r-d),a.font=metricsContext.label_font,a.fillStyle="white",a.textBaseline="top",a.textAlign="left",a.fillText("ascend",18,r-s-1),a.fillStyle="white",a.textBaseline="top",a.textAlign="left",a.fillText("descend",12,r+c-labelRectH+1),a.beginPath(),a.setLineDash([0,0]),a.fillStyle="#fff",a.lineWidth=2,a.fillRect(0,r-labelRectH,labelRectW,labelRectH),a.fillStyle="#999",a.textBaseline="top",a.textAlign="left",a.fillText("500UPM",10,r-labelRectH+3),a.beginPath(),a.strokeStyle="#D0021B",a.fillStyle="white",a.setLineDash([0,0]),a.lineWidth=2,a.moveTo(l,r-p),a.lineTo(line_length,r-p),a.stroke(),a.textBaseline="top",a.textAlign="right",a.fillText("cap height",line_length-1,r-p-labelRectH);performance.now()-e}function restrictRange(e){var t=metricsContext,n=t.curr_mtext_width,a=t.canvasT.width,i=0;return a>n?e>a-n*(1-i)?a-n*(1-i):-n*i>e?-n*i:e:e>a*i?a*i:-n+a*(1-i)>e?-n+a*(1-i):e}function mouseWheelEvent(e){var t=metricsContext,n=0;switch(e.type){case"DOMMouseScroll":n=Math.round(e.wheelDelta||10*e.detail);break;case"mousewheel":n=Math.round(e.deltaX||e.deltaY||e.wheelDelta);break;default:return!1}return t.translated=restrictRange(t.translated+n),drawText(),e.preventDefault(),e.stopPropagation(),!1}function pauseEvent(e){return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,!1}function toggleTab(e,t){e.preventDefault();var n=$(this).attr("href");$(this).addClass("current"),$(this).siblings().removeClass("current"),$(t).not(n).css("display","none"),$(n).fadeIn("fast")}function setFontControls(e,t){var n=$(t).closest(".font-control-wrapper").find("input"),a=jQuery.Event("keydown");a.which=e,$(n).trigger(a)}!function(e){e(document).ready(function(){function t(e,t,n,a){a?(e.removeClass("hidden"),e.data("credits-visible",!1),t.addClass("hidden"),window.setTimeout(function(){n.removeClass("hidden")},300)):(e.addClass("hidden"),e.data("credits-visible",!0),n.addClass("hidden"),t.removeClass("hidden"))}var n=e("#credits-toggle"),a=e("#credits-section"),i=e("#initial-section");n.on("click",function(r){r.preventDefault();var l=e(this).data("credits-visible");t(n,a,i,l)})})}(jQuery);var _int=function(e){return parseInt(e,10)},TCNDDF=TCNDDF||{};!function(){var e,t,n,a,i,r,l,o=document.createDocumentFragment(),s=window.localStorage||!1,c=window.applicationCache||window;TCNDDF.setup=function(){t=document.getElementById("fonts-listing"),e=document.getElementById("drop-area"),n=document.getElementById("displayContainer"),i=document.styleSheets[0],t.addEventListener("click",TCNDDF.handleFontChange,!1),s&&(n.addEventListener("keyup",function(){l=setTimeout("TCNDDF.writeContentEdits('mainContent')",1e3)},!1),n.addEventListener("keydown",function(){clearTimeout(l)},!1),TCNDDF.readContentEdits("mainContent")),e.addEventListener("dragenter",function(e){TCNDDF.preventActions(e)},!1),e.addEventListener("dragover",function(e){TCNDDF.preventActions(e)},!1),e.addEventListener("drop",TCNDDF.handleDrop,!1),c.addEventListener("updateready",TCNDDF.updateCache,!1),c.addEventListener("error",TCNDDF.errorCache,!1)},TCNDDF.handleDrop=function(e){var t=e.dataTransfer,n=t.files||!1,a=n.length,i=/^.*\.(ttf|otf|woff)$/i;TCNDDF.preventActions(e);for(var r=0;a>r;r++){var l,o,s=n[r],c=s.name;c.match(i)&&(l=c.replace(/\..+$/,""),l=l.replace(/\W+/g,"-"),o=Math.round(s.size/1024)+"kb",TCNDDF.processData(s,l,o))}},TCNDDF.processData=function(e,t,n){var a=new FileReader;a.name=t,a.size=n,a.readAsDataURL(e),a.addEventListener("load",function(){TCNDDF.buildFontListItem(event)})},TCNDDF.buildFontListItem=function(e){a=[document.createElement("li"),document.createElement("span"),document.createElement("span")];var l=e.target.name,s=e.target.size,c=e.target.result,d=getFontList(),p=$("<option>").prop("value",l).text(l),u=c.split("base64");-1==u[0].indexOf("application/octet-stream")&&(u[0]="data:application/octet-stream;base64",c=u[0]+u[1]),r="@font-face{font-family: "+l+"; src:url("+c+");}",i.insertRule(r,0),d.push(l),a[2].appendChild(document.createTextNode(s)),a[1].appendChild(document.createTextNode(l)),a[0].className="active",a[0].title=l,a[0].style.fontFamily=l,a[0].appendChild(a[1]),o.appendChild(a[0]),t.appendChild(o),$(t).fadeIn(),TCNDDF.updateActiveFont(a[0]),n.style.fontFamily=l,window.setTimeout(function(){$("#select-font").append(p),$("#select-font").val(l).trigger("change")},0)},TCNDDF.handleFontChange=function(e){var t=e.target||window.event.srcElement;"span"===t.nodeName.toLowerCase()?(t=t.parentNode,TCNDDF.updateActiveFont(t)):TCNDDF.updateActiveFont(t)},TCNDDF.updateActiveFont=function(e){var a=e.title,i=t.getElementsByTagName("li");n.style.fontFamily=a;for(var r=0,l=i.length;l>r;r++)i[r].className="";e.className="active"},TCNDDF.readContentEdits=function(e){var t=s.getItem(e);t&&"undefined"!==t&&(n.innerHTML=t)},TCNDDF.writeContentEdits=function(e){var t=n.innerHTML;s.setItem(e,t)},TCNDDF.updateCache=function(){c.swapCache()},TCNDDF.errorCache=function(){},TCNDDF.preventActions=function(e){e.stopPropagation&&e.preventDefault?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1)},window.addEventListener("load",TCNDDF.setup,!1)}();var metricsContext=function(){var e=function(e){return parseInt(e,10)},t=$("#metrics-canvas")[0],n=$("#text-canvas")[0];return t.width=2*e($(t).css("width")),t.height=2*e($(n).css("height")),n.width=2*e($(n).css("width")),n.height=2*e($(n).css("height")),{canvas:t,canvasT:n,context:t.getContext("2d"),contextT:n.getContext("2d"),reference_alphabet:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",metrics_fontsize:280,metrics_fallback:"60px sans",curr_typeface:null,curr_mtext:null,curr_mtext_width:0,label_font:"24px Helvetica",label_font_upm:"20px Helvetica",baseline_y:Math.round(.7*t.height),xOffL:2*e($(n).css("margin-left")),xOffR:e($(n).css("margin-right")),dragging:!1,lastX:0,translated:0}}(),hex2rgba=function(e){var t=parseInt(e.slice(1),16),n=[t>>16&255,t>>8&255,255&t,(t>>24&255)/255];return"rgba("+n.join(", ")+")"};window.onmousemove=function(e){var t=e||window.event,n=metricsContext;if(n.dragging){pauseEvent(t);var a=t.clientX-n.lastX;n.translated=restrictRange(n.translated+a),n.lastX=t.clientX,drawText()}},metricsContext.canvasT.onmousedown=function(e){var t=e||event;metricsContext.dragging=!0,metricsContext.lastX=t.clientX},window.onmouseup=function(){metricsContext.dragging=!1},localStorage.clear();var allConfigs=Object.freeze(function(){var e=performance.now(),t=RhythmicGridGenerator,n=[960,1280,1440],a=["1x1","4x3","3x2","16x9"],i=[3,4,5,6,7,8,9,10,11,12,13,14,15,16],r=[5,6,9,12],l=[0,1,2,3,4],o=t.generateAllRhytmicGrids(n,a,i,r,l),s=function(e,t){return parseInt(e)>parseInt(t)?1:-1};i=o.map(function(e){return e.baseline}).unique().sort(s),r=o.map(function(e){return e.columnsNum}).unique().sort(s),l=o.map(function(e){return e.gutterBaselineFactor}).unique().sort(s);performance.now()-e;return{widthArr:n,ratioArr:a,baselineArr:i,columnsArr:r,gutter2baselineFactorArr:l,allValidGrids:o,fontSizeLimit:{min:14,max:21},lineHeightLimit:{min:1,max:1.5},rangeArrs:[n,a,i,r,l],inputNames:["canvasWidth","gridRatio","gridBaseline","gridColumns","gridGutter"],gridContainer:$(".grid-container"),radioForms:$(".grid-section > .container > .flex-row > .flex-child:lt(5) > .form-group"),imageMocks:9,textMocks:Array.apply(null,{length:5}).map(function(e,t){return Lorem.prototype.createText(30*Math.exp(1.5*t),Lorem.TYPE.WORD).replace(/^(\w)/,function(e){return e.toUpperCase()})})}}());$(".tabs-toggle-wrapper a").click(function(e){toggleTab.call(this,e,".tab-content")}),["#select-font","#input-fontsize","#input-lineheight"].forEach(function(e,t){switch(t){case 0:var n=getAvailableSystemFonts(),a=$(e);a.empty(),n.forEach(function(e,t){var n=$("<option>").prop("value",e).text(e);t||n.prop("selected",!0),a.append(n)});var i=localStorage.getItem(a.attr("id"));i&&a.find('option[value="'+i+'"]').attr("selected","selected"),$(".example-text").css("font-family",a.val()+",monospace"),a.on("change",onFontChange).trigger("change");break;case 1:case 2:var r=$(e),l=localStorage.getItem(r.parent().attr("class"));l&&r.val(l),1==t?$(".example-text").css("font-size",parseInt(r.val())+"px"):$(".example-text").css("line-height",parseInt(r.val())+"px"),r.on("change",onFontChange),r.on("keydown",onKeyDown)}});var _LHFS_R=parseInt($("#input-lineheight").val(),10)/parseInt($("#input-fontsize").val(),10),_LHBL_F=function(){var e=parseInt($("#input-lineheight").val(),10);return e%3?e%2?1:2:3}();$("#fontmetrics-input-wrapper").on("keyup",onMetricsTextChange).trigger("keyup"),$(".ratio-selector .flex-row").on("change",function(){var e=$(".ratio-selector input[name=ratioSelector]:checked"),t=/\d+x\d+$/.exec(e.attr("id"))[0],n=$('.grid-section .flex-child input[name="gridRatio"][value="'+t+'"]');n.prop("checked",!0).trigger("change")}),setupRadioItems(allConfigs),$("#grid-toggle").on("click",function(e){e.preventDefault(),gridToggleBtn=$(e.target),"on"===gridToggleBtn.data("grid-toggle")?($(".rulers-wrapper-vertical").addClass("hidden"),$(".rulers-wrapper-horizontal").addClass("hidden"),gridToggleBtn.text("Show rulers"),gridToggleBtn.data("grid-toggle","off")):($(".rulers-wrapper-vertical").removeClass("hidden"),$(".rulers-wrapper-horizontal").removeClass("hidden"),gridToggleBtn.text("Hide rulers"),gridToggleBtn.data("grid-toggle","on")),localStorage.setItem("gridToggle",gridToggleBtn.data("grid-toggle"))}),$("#grid-toggle").data("grid-toggle","off"===localStorage.getItem("gridToggle")?"on":"off").trigger("click"),$("#sound-toggle").on("click",function(e){e.preventDefault(),soundToggleBtn=$(e.target),"on"===soundToggleBtn.data("sound-toggle")?soundToggleBtn.data("sound-toggle","off"):soundToggleBtn.data("sound-toggle","on")}),$("#photoshopButton").on("click",function(){$(this).addClass("link-disabled"),window.setTimeout(function(){$("#photoshopButton").removeClass("link-disabled")},3500)}),$(".controls .up").each(function(){$(this).on("click",function(e){e.preventDefault(),setFontControls(38,this)})}),$(".controls .down").each(function(){$(this).on("click",function(e){e.preventDefault(),setFontControls(40,this)})}),$(window).on("load",drawMetrics);